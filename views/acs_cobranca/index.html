{{extend 'layout.html'}}
{{from datetime import date}}

{{a=1}}
{{valor=0}}
{{recebido=0}}
{{despesa=0}}
{{deposito=0}}
{{caderno=0}}
{{fichas=0}}
{{total_adiantamento=0}}
{{total_vale_cobrador=0}}
{{saldo=0}}
{{debito=0}}
{{total_custo_devolucao_nova=0}}
{{total_custo_devolucao_aproveitamento=0}}
<div class="py-5">
    <div class="container">
        <div class="row">
        <div class="col-md-12">
          <h5 class="">Listagem de Rotas de Cobrança ( {{=projeto.descricao}} )</h5>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <a class="btn btn-link " href="{{=URL('acs_projeto','index', args=projeto.id)}}" style="color:#3b5998"><i class="fa fa-fw fa-1x py-1 fa-arrow-left"></i> Voltar</a>
          {{if usuario.id!=10:}}
          <a class="btn btn-link  m-1 border-info rounded-top" href="{{=URL('acs_relatorio','investimento', args=projeto.id)}}" style="color:#3b5998"><i class="fa fa-fw fa-1x py-1 fa-shield"></i> Ver Relatorio de Investimento</a>
          {{pass}}
        </div>
      </div>
      <div class="row">
          {{for row in rows:}}
        <div class="col-lg-4 col-md-6 p-3" >
          <div class="card bg-light">
            <div class="card-body p-4">
              <div class="row">
                <div class="col-6">
                  {{if row.auth_user:}}
                  <h6 class="mb-0">{{=row.auth_user.first_name}} {{=row.auth_user.last_name}}</h6>
                  {{else:}}
                  <h6>
                    Verificar Cobrador
                  </h6>
                  {{pass}}
                </div>
                <div class="col-6 text-right">
                  <h6 class="mb-0"> <b>R$ {{="{:,}".format(round(row.total_venda_praso,1)).replace(",","#").replace(".",",").replace("#",".")}}0</b> </h6>
                  <h7>{{=row.total_fichas}} Fichas</h7>
                </div>
              </div>
              <p class="my-3">{{=row.data_inicio_cobranca.strftime('%d/%m/%Y')}}<br>{{=row.primeira_cidade}}</p>
              
              <ul class="pl-3">
                <li>Recebido- <b>R$ {{="{:,}".format(round(row.total_recebido,1)).replace(",","#").replace(".",",").replace("#",".")}}0</b></li>
                <li>Despesa - <b>R$ {{="{:,}".format(round(row.total_despesa,1)).replace(",","#").replace(".",",").replace("#",".")}}0</b>{{if row.total_despesa>0 and row.total_recebido>0:}} ({{="{:,}".format(round(row.total_despesa/row.total_recebido*100,1)).replace(",","#").replace(".",",").replace("#",".")}}%) {{pass}}</li>
                <li>Deposito- <b>R$ {{="{:,}".format(round(row.total_deposito,1)).replace(",","#").replace(".",",").replace("#",".")}}0</b></li>
                  {{if row.total_recebido>0 and row.total_venda_praso:}}
                  <hr>
                <li><b>{{="{:,}".format(round(row.total_recebido/row.total_venda_praso*100,1)).replace(",","#").replace(".",",").replace("#",".")}}%</b></li>
                  {{pass}}
                
              </ul>
              
                  {{diferenca=date.today()-row.data_inicio_cobranca}}
              {{if True:}}
              {{if row.total_deposito>0 and row.total_recebido>0 and row.total_despesa>0:}}
              {{if diferenca.days>5 and not diferenca.days>150:}}
                  {{=diferenca.days}} Dias
              {{media_dia=row.total_recebido/diferenca.days}}
                  médias: 
              <br> R$ {{="{:,}".format(round(media_dia,1)).replace(",","#").replace(".",",").replace("#",".")}}0 Cobrado/Dia
              {{media_dia=row.total_deposito/diferenca.days}}
              <br> R$ {{="{:,}".format(round(media_dia,1)).replace(",","#").replace(".",",").replace("#",".")}}0 Depositos/Dia
              {{media_dia=row.total_despesa/diferenca.days}}
              <br> R$ {{="{:,}".format(round(media_dia,1)).replace(",","#").replace(".",",").replace("#",".")}}0 Despesa/Dia
              <hr>
              {{media_dia=row.total_recebido/diferenca.days}}
              {{setperc=row.total_venda_praso*0.60}}
              <br><b>60%</b> - em {{=int(round(setperc/media_dia, 0))}} Dias
               {{media_dia=row.total_recebido/diferenca.days}}
              {{setperc=row.total_venda_praso*0.65}}
              <br><b>65%</b> - em {{=int(round(setperc/media_dia, 0))}} Dias
              
              {{media_dia=row.total_recebido/diferenca.days}}
              {{setperc=row.total_venda_praso*0.7}}
              <br><b>70%</b> - em {{=int(round(setperc/media_dia, 0))}} Dias
              
              {{media_dia=row.total_recebido/diferenca.days}}
              {{setperc=row.total_venda_praso*0.75}}
              <br><b>75%</b> - em {{=int(round(setperc/media_dia, 0))}} Dias
              
              {{media_dia=row.total_recebido/diferenca.days}}
              {{setperc=row.total_venda_praso*0.8}}
              <br><b>80%</b> - em {{=int(round(setperc/media_dia, 0))}} Dias
              {{pass}}
              {{pass}}
              {{pass}}
                <hr>
              <a class="btn btn-primary mt-3" href="{{=URL('relatorio_cobranca', args=[row.id])}}">Acessar Cobrança</a>
            </div>
          </div>
        </div>
          {{if row.total_saldo_cobrador>0:}}
                  {{saldo+=row.total_saldo_cobrador}}
                  {{else:}}
                  {{debito+=row.total_saldo_cobrador}}
                  {{pass}}
                  {{if row.total_venda_praso>0:}}
                {{valor+=row.total_venda_praso}}
                  {{pass}}
              {{total_vale_cobrador+=row.total_vale_saida_cobrador}}
{{total_adiantamento+=row.adiantamento_cobranca}}
{{recebido+=row.total_recebido}}
                  {{despesa+=row.total_despesa}}
{{deposito+=row.total_deposito}}
{{caderno+=row.total_caderno_cobrador}}
                  {{if row.total_fichas>0:}}
                  {{fichas+=row.total_fichas}}
                  {{pass}}
          
{{total_custo_devolucao_nova+=row.total_custo_devolucao_nova}}
{{total_custo_devolucao_aproveitamento+=row.total_custo_devolucao_aproveitamento}}
          
        {{pass}}
        
      </div>
    </div>
  </div>

{{projeto.total_saldo_cobradores=saldo}}
{{projeto.total_debito_cobradores=debito}}

{{projeto.total_custo_devolucao_nova=total_custo_devolucao_nova}}
{{projeto.total_custo_devolucao_aproveitamento=total_custo_devolucao_aproveitamento}}

{{projeto.total_fichas=fichas}}
{{projeto.total_vale_caderno_cobrador=caderno}}
{{projeto.total_deposito_cobranca=deposito}}
{{projeto.total_despesa_cobranca=despesa}}
{{projeto.total_cobrado=recebido}}
{{projeto.total_adiantamento_cobranca=total_adiantamento}}
{{projeto.total_vale_cobrador=total_vale_cobrador}}
{{projeto.update_record()}}
