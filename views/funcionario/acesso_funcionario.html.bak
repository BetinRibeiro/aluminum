{{extend 'layout.html'}}
{{a=0}}
{{saldof=0}}
{{debitof=0}}
                {{totalvale=0}}
                {{totalcaderno=0}}
                {{totalsalario=0}}


<div class="py-5">
    <div class="container">
      <div class="row  text-center">
        <div class="col-md-12">
          <h3 class="mb-3">{{=projeto.descricao}}</h3>
          <p >Funcionarios</p>
        </div>
      </div>
<div class="row">
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-6 col-6 my-1" >
              <a  class="btn btn-outline-danger btn-block"  href="{{=URL('projeto','acesso_projeto', args=projeto.id)}}"> 
                <i class="fa  fa-arrow-left  fa-1x"></i>
              </a>
            </div>
            <div class="col-md-6 col-6 my-1" >
            {{if not projeto.venda_finalizada:}}
            <a class="btn btn-outline-success btn-block"  href="{{=URL('criar_funcionario', args=projeto.id)}}">
              <i class="fa  fa-plus fa-1x"></i>
              </a>
        {{pass}}
            </div>
          </div>
        </div>
        <div class="col-md-6"></div>
      </div>
      <div class="row">
        <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-striped table-borderless table-sm">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nome</th>
                                <th>Função</th>
                                <th>Salário</th>
                                <th>Vale</th>
                                <th>Caderno</th>
                                <th>Saldo</th>
                                {{if not projeto.venda_finalizada:}}
                                <th id="noprint">Alterar</th>
                                {{pass}}
                                {{if (usuario.id==11)or(usuario.id==1):}}
                  <th id="noprint" class="text-center">Verificação</th>

                  {{pass}}
                            </tr>
                        </thead>
                        <tbody>
                            {{for row in rows:}}
                            <tr>
                                {{a+=1}}
                                <td>{{=a}}</td>

                                <td>{{=row.nome.replace("cfrd","")}}</td>
                                <td>{{=row.funcao}}</td>
                                <td>R$ {{="{:,}".format(round(row.salario,1)).replace(",",".")}}0</td>
                                {{saldo=row.salario}}

                                <td>R$ {{="{:,}".format(round(row.vale_saida,1)).replace(",",".")}}0</td>
                                {{if not projeto.venda_finalizada:}}
                                <td>
                                        <a class="btn btn-outline-warning btn-block" href="{{=URL('acesso_vales', args=row.id)}}">R$ {{="{:,}".format(round(row.total_vale_caderno,1)).replace(",",".")}}0</a>
                                </td>
                                {{else:}}
                                <td>R$ {{="{:,}".format(round(row.total_vale_caderno,1)).replace(",",".")}}0</td>
                                {{pass}}
                                {{saldo=saldo-row.vale_saida-row.total_vale_caderno}}
                                {{if saldo > 0:}}
                                <td>R$ {{="{:,}".format(round(saldo,1)).replace(",",".")}}0</td>
                                {{else:}}
                                <th class="text-danger"><a>R$ {{="{:,}".format(round(saldo,1)).replace(",",".")}}0</a></th>
                                {{pass}}
                                {{if not projeto.venda_finalizada:}}
                                <th id="noprint"><a class="btn btn-outline-primary btn-block" href="{{=URL('alterar_funcionario', args=row.id)}}"><i class="fa fa-exchange" ></i></a></th>
                                {{pass}}
                   {{if (usuario.id==11)or(usuario.id==1):}}
                              <th id="noprint" class="text-center">
                              {{if 'cfrd' in row.nome:}}
                    <a class="btn btn-link" style="color:#55acee"  href="{{=URL('conferir', args=row.id)}}"><i class="fa fa-fw fa-1x py-1 fa-check" ></i> </a>
                    {{else:}}
                            <a class="btn btn-link" href="{{=URL('conferir', args=row.id)}}" style="color:#dd4b39"><i class="fa fa-fw fa-1x py-1 fa-square-o"></i> </a>
                    {{pass}}</th>
                                 {{pass}}
                            </tr>
                            {{if saldo>0:}}
                                {{saldof+=saldo}}
                            {{else:}}
                                {{debitof+=saldo}}
                            {{pass}}
                            {{totalvale+=row.vale_saida}}
                            {{totalcaderno+=row.total_vale_caderno}}
                            {{totalsalario+=row.salario}}
                        {{pass}}
                            <tr>
                                <th>#</th>
                                <th></th>
                                <th>#</th>
                                <th>R$ {{="{:,}".format(round(totalsalario,1)).replace(",",".")}}0</th>
                                <th>R$ {{="{:,}".format(round(totalvale,1)).replace(",",".")}}0</th>
                                <th>R$ {{="{:,}".format(round(totalcaderno,1)).replace(",",".")}}0</th>
                                <th>R$ {{="{:,}".format(round(saldof,1)).replace(",",".")}}0</th>
                               {{if not projeto.venda_finalizada:}}
                                <th></th>
                                {{pass}}
                            </tr>
                        </tbody>
                    </table>
    </div>
  </div>
</div>
</div>
</div>
</div>
</div>
</div>
{{projeto.total_debito_funcionario=debitof}}
{{projeto.total_saldo_funcionario=saldof}}
{{projeto.total_salario_funcionario=totalsalario}}
{{projeto.total_vale_funcionario=totalvale}}
{{projeto.total_caderno_funcionario=totalcaderno}}
{{projeto.quant_funcionario=a}}
{{projeto.update_record()}}
