{{extend 'layout.html'}}
{{a=0}}
{{saldof=0}}
{{debitof=0}}
<div class="row">
    <div class="col-md-6">
        <a  class="btn btn-outline-light" href="{{=URL('projeto','acesso_projeto', args=projeto.id)}}"> <i class="fa text-danger fa-arrow-left  fa-2x"></i></a>
        {{if not projeto.venda_finalizada:}}
            <a  class="btn btn-outline-light" href="{{=URL('criar_funcionario', args=projeto.id)}}"><i class="fa text-success fa-plus fa-2x"></i></a>
        {{pass}}
    </div>
</div>
       
                {{if len(rows)>0:}}
                Funcionarios da venda de {{=projeto.descricao}}
                {{else:}}
                Você precisa cadastrar um funcionario
                {{pass}}
                {{totalvale=0}}
                {{totalcaderno=0}}
                {{totalsalario=0}}
                <div class="table-responsive">
                    <table class="table table-striped table-borderless table-sm">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nome</th>
                                <th>Função</th>
                                <th>Salário</th>
                                <th>Vale</th>
                                <th>Caderno</th>
                                <th>Saldo</th>
                                {{if not projeto.venda_finalizada:}}
                                <th id="noprint">Alterar</th>
                                {{pass}}
                            </tr>
                        </thead>
                        <tbody>
                            {{for row in rows:}}
                            <tr>
                                {{a+=1}}
                                <td>{{=a}}</td>

                                <td>{{=row.nome}}</td>
                                <td>{{=row.funcao}}</td>
                                <td>R$ {{="{:,}".format(round(row.salario,1)).replace(",",".")}}0</td>
                                {{saldo=row.salario}}

                                <td>R$ {{="{:,}".format(round(row.vale_saida,1)).replace(",",".")}}0</td>
                                {{if 
                                <td>
                                        <a href="{{=URL('acesso_vales', args=row.id)}}">R$ {{="{:,}".format(round(row.total_vale_caderno,1)).replace(",",".")}}0</a>
                                </td>
                                {{saldo=saldo-row.vale_saida-row.total_vale_caderno}}
                                {{if saldo > 0:}}
                                <td>R$ {{="{:,}".format(round(saldo,1)).replace(",",".")}}0</td>
                                {{else:}}
                                <th class="text-danger"><a>R$ {{="{:,}".format(round(saldo,1)).replace(",",".")}}0</a></th>
                                {{pass}}
                                {{if not projeto.venda_finalizada:}}
                                <th id="noprint"><a href="{{=URL('alterar_funcionario', args=row.id)}}"><i class="fa text-warning fa-exchange" ></i></a></th>
                                {{pass}}
                                
                            </tr>
                            {{if saldo>0:}}
                            {{saldof+=saldo}}
                            {{else:}}
                            {{debitof=saldo}}
                            {{pass}}
                            {{totalvale+=row.vale_saida}}
                            {{totalcaderno+=row.total_vale_caderno}}
                            {{totalsalario+=row.salario}}
                            {{pass}}
                            <tr>
                                <th>#</th>
                                <th></th>
                                <th>#</th>
                                <th>R$ {{="{:,}".format(round(totalsalario,1)).replace(",",".")}}0</th>
                                <th>R$ {{="{:,}".format(round(totalvale,1)).replace(",",".")}}0</th>
                                <th>R$ {{="{:,}".format(round(totalcaderno,1)).replace(",",".")}}0</th>
                                <th>R$ {{="{:,}".format(round(saldof,1)).replace(",",".")}}0</th>
                               {{if not projeto.venda_finalizada:}}
                                <th></th>
                                {{pass}}
                            </tr>
                        </tbody>
                    </table>
                </div>
           
{{projeto.total_debito_funcionario=debitof}}
{{projeto.total_saldo_funcionario=saldof}}
{{projeto.total_salario_funcionario=totalsalario}}
{{projeto.total_vale_funcionario=totalvale}}
{{projeto.total_caderno_funcionario=totalcaderno}}
{{projeto.quant_funcionario=a}}
{{projeto.update_record()}}
