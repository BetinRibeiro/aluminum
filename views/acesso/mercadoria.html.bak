{{extend 'layout.html'}}

{{pcas=0}}
{{total=0}}
{{custo=0}}
{{carrada=1}}

 <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-12">

          <h5>Relatório de Mercadoria - {{=projeto.descricao}}&nbsp;</h5>
<div class="table-responsive">
    <table class="table thead-light table-sm table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Quant</th>
                <th>Descrição</th>
                <th>Preço</th>
                <th>Total</th>
                <th>Custo</th>
                <th>Total</th>
                <th>%</th>
            </tr>
        </thead>
            <tbody>
                {{cont=1}}
                {{for row in rows:}}
                 {{total_custo=row.custo_unitario*row.q_pcs}}
                    {{total_preco=row.preco_unitario*row.q_pcs}}
                    {{if carrada==1:}}
                    {{carrada=row.carrada}}
                    {{else:}}
                    {{if carrada!=row.carrada:}}
                    {{carrada=row.carrada}}
                    {{cont+=1}}
                <thead>
                     <th nowrap="true">
                        {{=pcas}}
                    </th>
                    <th nowrap="true">
                        <i class="fa text-dark fa-bars"></i>
                    </th>
                    <th nowrap="true">
                        <i class="fa text-dark fa-bars"></i>
                    </th>
                    <th nowrap="true">
                        R$ {{="{:,}".format(round(total,1)).replace(",",".")}}0
                        
                    </th>
                    
                    <th nowrap="true">R$ {{="{:,}".format(round(0,1)).replace(",",".")}}0
                    </th>
                    <th nowrap="true">R$ {{="{:,}".format(round(custo,1)).replace(",",".")}}0
                    </th>
                    {{if (custo>0) and (total>0):}}
                    {{margem=total/custo*100}}
                    {{else:}}
                    {{margem=0}}
                    {{pass}}
                         {{if not (margem>=350) and (margem>250):}}
                        <td nowrap="true" >
                            <i class="fa text-warning fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                     {{elif margem>=350:}}
                        <td  nowrap="true">
                                <i class="fa text-success fa-circle"></i>
                            {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                      {{else:}}
                        <td nowrap="true" >
                            <i class="fa text-danger fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                        {{pass}}
                </thead>
                
{{pcas=0}}
{{total=0}}
{{custo=0}}
                 </table>
</div>
<div class="table-responsive">
    <table class="table thead-light table-sm table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Quant</th>
                <th>Descrição</th>
                <th>Preço</th>
                <th>Total</th>
                <th>Custo</th>
                <th >Total</th>
                <th>%</th>
            </tr>
        </thead>
            <tbody>
                    {{pass}}
                    {{pass}}
                    
                <tr>
                    
                    <td nowrap="true">
                            {{=row.q_pcs}}
                    </td>
                    <td nowrap="true">
                            {{=row.descricao}}
                    </td>
                    <td nowrap="true">
                            R$ {{="{:,}".format(round(row.preco_unitario,1)).replace(",",".")}}0
                    </td>
                    <td nowrap="true">
                            R$ {{="{:,}".format(round(row.preco_unitario*row.q_pcs,1)).replace(",",".")}}0
                    </td>
                    
                    <td  nowrap="true">
                                R$ {{="{:,}".format(round(row.custo_unitario,1)).replace(",",".")}}0
                        </td>
                        <td  nowrap="true">
                                R$ {{="{:,}".format(round(row.custo_unitario*row.q_pcs,1)).replace(",",".")}}0
                        </td>
                    {{if (total_preco>0) and (total_custo>0):}}
                    {{margem=total_preco/total_custo*100}}
                    {{else:}}
                    {{margem=0}}
                    {{pass}}
                         {{if not (margem>=350) and (margem>250):}}
                        <td nowrap="true">
                            <i class="fa text-warning fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                     {{elif margem>=350:}}
                        <td nowrap="true">
                                <i class="fa text-success fa-circle"></i>
                            {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                      {{else:}}
                        <td nowrap="true">
                            <i class="fa text-danger fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                        {{pass}}
                </tr>
                        {{pcas+=row.q_pcs}}
                        {{total+=row.preco_unitario*row.q_pcs}}
                        {{custo+=row.custo_unitario*row.q_pcs}}
                {{pass}}
                <tr>
                    <th>
                        {{=pcas}}
                    </th>
                    <th>
                        <i class="fa text-dark fa-bars"></i>
                    </th>
                    <th>
                        <i class="fa text-dark fa-bars"></i>
                    </th>
                    <th>
                        R$ {{="{:,}".format(round(total,1)).replace(",",".")}}0
                    </th>
                    
                    <th
                        >R$ {{="{:,}".format(round(0,1)).replace(",",".")}}0
                    </th>
                    <th
                        >R$ {{="{:,}".format(round(custo,1)).replace(",",".")}}0
                    </th>
                   
                    
                     {{if (custo>0) and (total>0):}}
                    {{margem=total/custo*100}}
                    {{else:}}
                    {{margem=0}}
                    {{pass}}
                         {{if not (margem>=350) and (margem>250):}}
                        <td>
                            <i class="fa text-warning fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                     {{elif margem>=350:}}
                        <td >
                                <i class="fa text-success fa-circle"></i>
                            {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                      {{else:}}
                        <td>
                            <i class="fa text-danger fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </td>
                        {{pass}}
                </tr>
        </tbody>
    </table>
</div>

<div class="table-responsive">
    <table class="table thead-light table-sm table-striped">
        <thead>
            <tr>
                <th>{{=projeto.total_pecas_mercadoria}}</th>
                <th>Total Geral</th>
                <th>Preço de Venda</th>
                <th>R$ {{="{:,}".format(round(projeto.total_preco_mercadoria,1)).replace(",",".")}}0</th>
                <th>#</th>
                <th>R$ {{="{:,}".format(round(projeto.total_custo_mercadoria,1)).replace(",",".")}}0</th>
                
                     {{if (projeto.total_custo_mercadoria>0) and (projeto.total_preco_mercadoria>0):}}
                    {{margem=projeto.total_preco_mercadoria/projeto.total_custo_mercadoria*100}}
                    {{else:}}
                    {{margem=0}}
                    {{pass}}
                         {{if not (margem>=350) and (margem>250):}}
                        <th>
                            <i class="fa text-warning fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </th>
                     {{elif margem>=350:}}
                        <th>
                                <i class="fa text-success fa-circle"></i>
                            {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </th>
                      {{else:}}
                        <th>
                            <i class="fa text-danger fa-circle"></i>
                                {{="{:,}".format(round(margem,0)).replace(".0","")}}%
                        </th>
                        {{pass}}
            </tr>
        </thead>
    </table>
</div>
</div>
</div>
</div>
</div>
